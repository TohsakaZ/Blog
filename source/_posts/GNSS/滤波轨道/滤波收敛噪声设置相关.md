## SRIF中滤波收敛相关问题

### 研究现状

范磊 2017 博士论文中  过程噪声的设置为 位置 1e-12 速度 1e-12 SRP参数 1e-12

戴 2019 GPS .sol 文章中 过程噪声的设置为 位置 1.73e-12 速度 1e-12 SRP参数 1e-12 但根据 匡2019博士论文说法 其正确的数值应该是  位置 1.73e-9 速度 1e-9 SRP参数1e-18 这就很离谱。。

Duan 2019 设置 位置速度为 0  SRP参数为 1e-13  这里0噪声在SRIF中该咋设置？？

------

这里比较迷惑的是，这些文章中给出的噪声到底是已经考虑了观测时间还是没考虑呢？目前看来光压参数的设置较为统一均在12-14次方之间，速度位置则各有方案。



### 研究思路

* 状态矩阵方差设置（位置和速度采用了一阶高斯马尔可夫模型，SRP参数为噪声乘以单位阵），这里注意一下高斯马尔可夫模型噪声Q阵

和相应信息阵之间的推导公式：
$$
TODO:\\
Q=[]\\
R=[]\\
$$

* 这里，戴2016中仅考虑了随机游走模型来设置噪声，这里能否根据线性化的状态转移矩阵来得到协方差阵的设置呢？

  目前实现了 通过状态转移矩阵积分来获取噪声阵 但效果不佳

* 考虑分析事后解中的光压参数的变化情况？求出变化的噪声方差？学习下相关SRP参数的内容？帮助分析ORB参数的设置

* 

考虑一下几种方案：

1. 能否仅仅转移卫星的位置和速度，即不转移SRP参数。需要进行测试（相当于分段线性估计SRP参数？）

2. 在这里线性化程度起到了关键的作用，因为线性化误差较大的，主要在于其影响了状态转移的过程，同时由于所给的状态转移误差噪声较小。因此可以测试，在第一天进行整体最小二乘的方式进行结算，后面几个小时根据超快速的预报精度（每两个小时或一个小时就更新线性化参数）这样的方案是否会得到更好的轨道精度？能持续多久？

3. 最好的方式是能够根据状态转移矩阵来推导出相应的协方差矩阵。但是鉴于那个是积分 似乎不太好设置。。

   这个方法目前已经实现，但具体效果不好

4. 目前主要是A方向上差别挺大，是否能考虑分段采用不同的噪声？（收敛阶段的噪声方差 和 后续不一致， 以及在重新线性化的弧段适当放宽 噪声方差阵？（没什么作用）

5. 测试三天解的收敛情况



### 实验结果

* 方案1. 位置速度设置随机游走， SRP参数设置单位阵乘噪声

  速度位置为 1e-12 光压为 1e-12  粗差阈值为 3

  <img src="D:\work\GNSS\实时滤波轨道\result_rtpod\ACR_2020105_140_SRIF_OI_check_orb.png" alt="ACR_2020105_140_SRIF_OI_check_orb" style="zoom: 33%;" />

  

  速度位置为 1e-12 光压为 1e-13 粗差阈值为5.0

  <img src="D:\work\GNSS\实时滤波轨道\result_rtpod\ACR_2020105_140_SRIF_OI_check_orb_12_13_5.png" alt="ACR_2020105_140_SRIF_OI_check_orb_12_13_5" style="zoom: 33%;" />

  方案3. 

  位置速度为 1.0e-12 光压为 1.0e-12 粗差为5.0  重新线性化放宽了100倍权重， 后续阶段使用0.01倍原始噪声

  <img src="D:\work\GNSS\实时滤波轨道\result_rtpod\ACR_2020105_140_SRIF_OI_check_orb_12_12_5_duan.png" alt="ACR_2020105_140_SRIF_OI_check_orb_12_12_5_duan" style="zoom:33%;" />

  方案4.
  
  将状态转移矩阵的方差噪声设置为0，结果和1E-12权的结果基本一致。

### 一些结论

1. 总的来说，小范围改变噪声对精度影响并不显著。目前来说速度位置设置-12， SRP参数在-14和-12之间都较为合理。
2. 由于耗时较长的问题，通过积分获取噪声方差 和 直接设置两种方式并没有发现明显的优劣关系。

### 一些代码实现中的具体注意事项

1. 考虑到积分获取方差值过于耗时，这里改为并行。

## SRIF质量控制相关的问题

基于SRIF的质量控制 目前主要分为几个部分：

* 粗差探测

  这里基本框架思路一致，都是假定某个观测值具有bias，由于Q阵（QR变换的正交阵）可以直接给出bias对最后验后残差的影响值，因此可以通过其可以估算出最佳的bias值。

  这里需要注意的是，计算最佳bias值时应该所有之前探测到的bias一起计算，

* 粗差修复

  这里主要是需要考虑到需要将新增的bias参数作为参数加入到方程中，但是这个应该和直接改到z上没有甚么区别？

  同时对于包含粗差的相位观测值认为时发生了周跳，通过采用重新估计模糊度的方式来处理

如何设置粗差监测阈值

* 判断归一化后的验后残差最大值 和 阈值（一般设置3.0)
* 遍历的观测数（最大残差、20%所有观测值、所有观测值、或者是某个常数）
* 判断sigma0的置信度
* 通过估计bias值后，判断验后残差最大值 前后发生的变化，以及sigma0值前后发生的变化

### 质量控制方案实验结果

> 以下结果均是设定在速度位置（为随机游走的方式）、SRP参数噪声为1e-12的前提

* 采用max_res和sigma0和之前的 0.8倍作为比较 作为检测判断条件。同时统一估计所有检测出的bias最优值，将bias参数增加到滤波中来更新滤波。

  <img src="D:\work\GNSS\实时滤波轨道\result_rtpod\ACR_2020105_140_SRIF_OI_orb_newQC.png" alt="ACR_2020105_140_SRIF_OI_orb_newQC" style="zoom:33%;" />

  <img src="D:\work\GNSS\实时滤波轨道\result_rtpod\Series_2020105_140_SRIF_OI_orb_newQC.png" alt="Series_2020105_140_SRIF_OI_orb_newQC" style="zoom:33%;" />

  这里额外测试了的三天解（剔除了G08卫星）情况：

  <img src="D:\work\GNSS\实时滤波轨道\result_rtpod\ACR_2020105_140_SRIF_newQC_3d.png" alt="ACR_2020105_140_SRIF_newQC_3d" style="zoom:33%;" />

  <img src="D:\work\GNSS\实时滤波轨道\result_rtpod\Series_2020105_140_SRIF_OI_newQC_3d.png" alt="Series_2020105_140_SRIF_OI_newQC_3d" style="zoom:33%;" />

  **G21发生跳变的原因**：给定的粗差阈值过小了，这里给定5.0的max_res_norm，就恢复正常。

* 测试使用测站钟作为参考钟的情况

  结果和使用卫星钟是一致的。

### 质量控制的一些结论：

1. 目前使用参考钟是卫星钟还是测站钟没有什么区别。
2. 某些卫星如果出现突然的跳变（如上图的G21），主要原因还是因为相位模糊度估计错误导致。
3. 目前测试的算例（2020106、107）G08、G18普遍出现精度不收敛的情况。暂时没有想到解决思路，是否跟观测数据质量，以及协方差分布有关？需要进行多天的测试
4. 目前经验上来说最佳的判断方式依然采用 0.8倍最大值 作为置信度判断，max_res_norm使用5.0 max_sigm0采用0.9置信度的卡方分布。
5. 上述结论还有待更多的测试数据进行验证。

## 积分步长影响

这里修改了重新线性化部分的改正数（正负号推错了），对结果有一定程度的影响，非常小。

下面给出了2020 106的算例（剔除了G08 G18卫星）

<img src="D:\work\GNSS\实时滤波轨道\result_rtpod\ACR_2020105_140_SRIF_newQC_newOI_3d.png" alt="ACR_2020105_140_SRIF_newQC_newOI_3d" style="zoom:33%;" />

<img src="D:\work\GNSS\实时滤波轨道\result_rtpod\Series_2020105_140_SRIF_OI_newQC_newOI_3d.png" alt="Series_2020105_140_SRIF_OI_newQC_newOI_3d" style="zoom:33%;" />





## 滤波模糊度固定相关

