**测量平差目的**

本质就是为了在带有误差的观测数据中确定最优解

涉及函数模型、随机模型、最优准则、求解方法

最传统的最小二乘的前提：

* 带有偶然误差观测值、方程为线性

* 观测值服从正太分布，且相互独立

**后续的扩展**：

1、考虑系统误差和粗差情况

2、代求参数为随机变量（即待估参数本身也是个随机量，如观测方程就认为是个随机量）

3、秩亏情况下 最小二乘的求解（加约束）

4、根据求解的后验结果进行定权， 常规做法是通过先验定权的方式

5、粗差的处理、稳健估计（即系数阵不稳定的情况下）

**主要概念**

随机变量：离散、连续、概率分布函数、期望（多个随机变量之间的关系，推导出期望的运算规律）

* 这里一定要理解**随机变量**。简单来说就是值不确定，具体的代表就是误差。但不是所有变量都一定是随机变量，如空间上两点的距离，应该是一个确定值，但这个距离的观测值却是离散的，因为包含了误差。所以有的随机变量可能是属于确定部分和随机部分的叠加。那么确定部分实际上就是期望，期望为0时即它全部是随机部分。 （Note:这里确定部分和随机部分的概念是方便理解，不是学术上的定义）

* 因为变量值不确定，很容易就引申出对每个可能值进行一个概率表示，即概率分布函数。

* 期望：

  $$
  E(CX) = CE(x),C为常数\\
  E(X+Y)=E(x)+E(Y)\\
  X Y 独立情况下：\\
  E(XY) = E(X)E(Y)
  $$
  
* 方差
  $$
  D(x)=E[(x-E(x))^2]
  $$
  
  描述了一种不确定度、离散程度
  
  
  
* 协方差
  $$
  \sigma_{xy}=E{[x-E(x)][y-E(y)]}
  $$
  描述两个随机变量之间的相关程度

  协方差矩阵本质上就是多个随机变量之间的相关性。

随机过程：假定之前探讨的随机变量是在某个特定时间点，或跟时间无关的情况下。现在在随机变量上增加时间维 从而进一步探讨相关性质。

正态分布：多个独立的随机变量（无论原来的随机变量服从什么分布）叠加之后，总和是服从正太分布的。（**中心极限定理**证明了这一点，多个独立同分布的随机变量叠加之和是符合正态分布的，多个独立均匀不同分布的随机变量叠加之和是近似正太分布的） 

* 这里关键点在于给定了测量误差（或者是观测量）是符合正太分布的一种科学解释。因为测量误差可以认为是多个小误差量进行叠加的结果。每个小误差看作是一个随机变量。
  $$
  f(x)=\frac{1}{\sqrt{2\pi}\sigma}exp\{{-\frac{1}{2\sigma^2}}(x-\mu)^2\}
  $$

精度评定的相关指标：

* 中误差 RMS （root mean square)，其实对应正态分布中的标准差（STD）（方差的根号），表征了离数学期望的接近程度或则说是偶然误差大小程度，或者说不确定度。（注意下 RMS和STD的计算过程一样，只是应用于不同领域中叫法不一致，RMS在测绘领域用于误差大小程度，STD在数理统计领域中用于表征数据本身的离散程度）

* 极限误差，三倍中误差

* 精度：用中误差（标准差）即可衡量表示，前提是只存在偶然误差（即是正态分布的情况下）

* 准确度：真值和数学期望的差值

* 精确度：MSE（Mean Squared Error) 即均方误差 RMSE 均方根误差 衡量的是整体误差（包括偶然和系统）的大小程度。 
  $$
  MSE(X) =E[(X-\overline{X})^2],\overline{X}表示真值
  $$
  当真值为0时RMSE退化为RMS

  

当观测误差或观测量为满足正太分布的随机变量的时候，最小二乘可以从最大似然估计导出

**《测量平差》基本内容**

**方差协方差传播定律**， 本质就是给出随机变量的函数的方差和随机变量的方差之间的关系。（这里之所以称之为误差传播定律，实际指的是传播中误差，即方差开根号）
$$
Z(X)=KX\\
D_{zz}=KD_{xx}K^T
$$
这里K矩阵在非线性情况下采用的是泰勒展开的一阶导数系数。这里之所以可以使用一阶导，是认为观测值所带的误差相对于观测值本身是小值，因此可以忽略高阶项带来的误差。

另外就是定权的概念（本质就是给定先验的随机模型，即给定方差-协方差矩阵）
$$
P_{i}=\frac{\sigma_{0}^2}{\sigma_{i}^2}
$$
**单位权中误差**：可以是任意选定的一个常数，其单位与观测值中误差（在同观测类型条件下）相同。因此一般是选择某个特定的观测值（实际上不存在，但我假定它具有这样的中误差）中误差作为单位权中误差。

* 这里就解释了为什么GNSS方程中，定权是直接按照观测值的先验误差值或待估参数先验误差值倒数的平方。因为这里**直接定义了具有1m中误差的观测值为单位权中误差**，因此所有需要定权的地方都应该是将先验中误差划算成m的单位。当然，这里也可以选用其他单位，只要统一就好了，反正权重要的是他们之间的比例关系，实际大小不影响结果（当然还要考虑定权过大过小容易导致矩阵计算过程中的截断误差）

为什么这里给的是权的概念？重要的是给出不同观测量之间的比例关系。

由方差-协方差传播定律，可以自然导出权的传播定律。

引出协因数、协因数阵的概念：类似方差、协方差，只是同时除以了单位权中误差。其传播公式和协方差是一致，就只是统一缩小了一个倍数。

权阵一般就是称为协因数阵的倒数。其实当选取单位权为1的时候，协因数阵 就等同于 方差阵。权阵与方差阵直接就是互逆的关系。

至于条件平差、间接平差等等，只是函数模型不一致而已。目前暂时都统一到间接平差上来看，即观测值可以表示为待估参数的函数。

紧接着引入了测量平差求解的问题：待估参数需要满足某种最优性质（或者说约束，否则方程没法解），这里选用的是最小二乘准则。

* 因为待估参数的**估计值**本质上来说就是观测值的函数，而观测值是随机量，因此估计量也是一个随机量，因此需要考虑随机量的数理统计上的最优性质。
* 这里的最优性质就是数理统计要求的估计量的最优性质：**无偏性**、**一致性**、**有效性**
* 在最小二乘估计中一般来说：无偏性由准确的函数模型保证、有效性则是由准确的随机模型保证

在**观测量为正态分布的情况**下，可以从最大似然估计推导出最小二乘法，即残差合最小。

验后单位权中误差的求解，用于判断是否符合单位权中误差（因此GNSS中设定单位权为1的时候，验后单位权中误差是越接近1越好，而不是越小越好）

同时待估参数的协因数阵乘以单位权中误差平方就是各个参数的验后方差。开方之后，就是验后中误差。

引入概括平差模型，数学上证明最小二乘的最优性质，以及验后单位权中误差是先验中误差的无偏估计。

后续就是一些考虑其他情况的平差：

包括：考虑系统误差、秩亏的情况、待估参数具有先验方差。

**《广义测量平差》**

其绪论总结了测量平差做的事情（即由带有某种随机分布的观测量构造待估量的解）以及RMSE 和 RMS之间的关系

极大似然估计（最小二乘估计） 极大验后估计（考虑待估的先验方差） 最小方差估计（卡尔曼滤波）他们之间的关系以及推导

**多维正态分布**

* 这里需要注意多维正态分布中的每个随机变量有可能是相关的，即协方差阵不为对角阵，当所有变量都独立，则协方差阵退化为对角阵
  $$
  f(\overrightarrow{X})=\frac{1}{(2\pi)^\frac{n}{2}|D_{X}|^\frac{1}{2}}exp\{-\frac{1}{2}(X-\mu_X)^TD^{-1}_X(X-\mu_X)\}
  $$
  这里推导思路是将原有的随机变量通过线性变换变成不相关的，注意这里隐含的线性变换为如下：
  $$
  D_X=BB^T\\
  Z=B^{-1}(X-\mu_X),Z为互相独立的正太分布变量
  $$

  * 协方差矩阵是半正定的，根据定义可以推导

* 关于多维正态分布的条件概率密度的推导。（这个推导公式主要是为了引出后续在随机量服从正态分布的情况下，可以推导出最大似然估计等价于最小二乘估计）

**极大似然估计**
$$
f(L/x)=Max
$$
最小二乘估计准则：
$$
V^TPV=Min\\
L=F(X)+\Delta, V=F(X)-L\\
x=(B^TPB)^{-1}B^TPL\\
当观测方程选取的待估参数初值不为0的时候\\
需要把观测值中的值扣除初值等效的部分(观测-计算）\\
V=Bx-[L-F(X)]
$$


极大似然估计和最小二乘估计都没有利用参数的随机性质（即它的先验期望和方差）

两者在观测值和参数X是随机向量的时候是可以等价推导的（无论观测值之间独不独立，需要注意当观测值之间不独立的时候，这时候最小二乘的权阵并不能为对角阵，必须满足下述条件

**极大验后估计**

* 极大验后估计准则 

**《最优估计》基本内容**



**《最优化估计导论》基本内容**



本科的测量平差基本就是在探讨一些上述问题即求解，感觉可以看成是特殊情况下的最优估计？和最优估计等的联系？？

《最优化估计导论》是探讨在给定了问题的函数模型、随机模型、最优准则下的求解方法？如牛顿、最小二乘等等。。。

《最优估计》则是探讨如何对带有误差值观测量，存在运动模型，求解出最优解 这样问题的 建模和求解

《测量平差》则针对的问题则是更具体的带有偶然误差

等于说前面的不涉及具体建模只是单独针对求解，后面两者则针对了具体问题进行建模和求解（选择了最小二乘或卡尔曼滤波）

