# 分布式系统

## 概念

1、分布式系统本身是一种基础架构，是通过网络通信来协作多台节点（机器）来完成某件事情。它提供给用户（程序开发者）是一种抽象（计算、存储、通信），实际就意味着是一种接口，用户无需感知具体实现（这种抽象在计算机科学中十分常见）。

2、 RPC、Threads、Courrency Control是常见构建这类系统需要使用的工具

## 特性

1、 性能（Performance)

可扩展性（scalability）：需要经过系统设计才能使原有单机的运行的服务具有可扩展能力。

我的理解隐含的问题：

* 如何划分数据
* 如何找到并行的点（针对计算？）

2、容错能力(Availability)

可用性（availability): 能容忍一定数量故障（不是全部）

可恢复（recoverability)

两个基本想法：

*  非易失性存储
* 副本（引出一致性问题

3、 一致性问题（Consistency）

上述三方面构成了描述分布式系统的指标（CAP)，他们很难被同时满足。

这里我的理解如下：

实现强一致性就意味着需要大量的通信，这对性能P就有很大影响

实现更高可用性，意味着需要更多的副本，也意味着一致性实现难度更高

他们之间基本是相互制约的。

## 基本解决思路

这里我的理解就是针对上述的一些问题的基本解决思路

### 关于数据划分

最关键的问题都是需要维护元数据，至于元数据维护复杂程度高低则跟才用的哈希协议相关。

### 副本协议

为了提高可用性（Availability），基本思路：中心化副本协议、去中心化副本协议

中心化副本协议考虑的问题：

1、数据更新（先主节点 primary 再从节点）

2、数据读取（看一致性情况，一致性不高的情况下，所有节点均可视为读节点）

3、主节点的切换（两个问题 

* 如何解决节点状态探测？Lease机制 这也是中心化副本的根本缺陷所在，因为探测会被限制在一定的时间频率，因此会有一定时间的可用性的缺失
* 切换过程中如何解决一致性问题？

这里Lease机制的引入，一般是通过不断的往某个第三方节点发消息，一旦发现主节点挂了就进行切换。这又将问题引入了第三方节点的可用性。因此一般会使用多个第三方节点（这里第三方节点本质上就是Redis中的多哨兵机制）

为了解决中心化中可能带来的不可用的问题（即主节点挂了之后导致的无法更新数据库），又引入了去中心化的副本协议。

这里我理解Redis的集群模式应该是一种分布式扩展的哨兵模式，应该不太能算去中心化的副本协议，因为本质上它的副本协议还是遵循着中心化副本协议，这里的去中心化应该说是指去元数据中心，不需要单独的访问元数据中心来访问不同的数据。Redis既使用呢了Gossip协议 取消了中心**元数据**控制节点，使得控制节点不唯一。但在副本同步上还是遵循主从模式。此时可以认为其他节点代替了哨兵的地位。

Paxos协议（典型的去中心化协议）
